<div class="crear-cancha-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <button class="btn-back" (click)="cancelar()">
        <span class="material-icons">arrow_back</span>
      </button>
      <h1>{{ isEditMode ? 'Editar Cancha' : 'Creación de Canchas' }}</h1>
    </div>
  </div>

  <!-- Formulario -->
  <div class="form-container">
    <form (ngSubmit)="guardarCancha()" #canchaForm="ngForm">
      <!-- Fila 0: Imagen de la cancha -->
      <div class="form-row">
        <div class="form-group full-width">
          <label for="imagen">Imagen de la cancha</label>
          <div class="image-upload-container">
            <div class="image-preview" *ngIf="imagenPreview">
              <img [src]="imagenPreview" alt="Preview">
              <button type="button" class="btn-remove-image" (click)="eliminarImagen()">
                <span class="material-icons">close</span>
              </button>
            </div>
            <div class="upload-area" *ngIf="!imagenPreview" (click)="fileInput.click()">
              <span class="material-icons">add_photo_alternate</span>
              <p>Haz clic para seleccionar una imagen</p>
              <span class="upload-hint">JPG, PNG o WEBP (máx. 5MB)</span>
            </div>
            <input
              #fileInput
              type="file"
              id="imagen"
              name="imagen"
              accept="image/jpeg,image/png,image/webp"
              (change)="onImageSelected($event)"
              style="display: none;"
            />
          </div>
        </div>
      </div>

      <!-- Fila 1: Nombre y Deporte -->
      <div class="form-row">
        <div class="form-group">
          <label for="nombre">Nombre de la cancha</label>
          <input
            type="text"
            id="nombre"
            name="nombre"
            [(ngModel)]="canchaData.nombre_cancha"
            placeholder="Ej: Cancha 1"
            required
            maxlength="100"
            #nombreInput="ngModel"
          />
          <div *ngIf="nombreInput.invalid && nombreInput.touched" class="error-message">
            <span class="material-icons">error</span>
            El nombre es obligatorio
          </div>
        </div>

        <div class="form-group">
          <label for="deporte">Deporte</label>
          <div class="dropdown-deporte" [class.activo]="dropdownDeporteAbierto()">
            <button
              type="button"
              class="btn-dropdown-custom"
              (click)="toggleDropdownDeporte()"
              [class.activo]="dropdownDeporteAbierto()">
              <span class="dropdown-current">
                <i class="fas fa-futbol"></i>
                {{ getNombreDeporte() }}
              </span>
              <i class="fas fa-chevron-down"></i>
            </button>

            @if (dropdownDeporteAbierto()) {
              <div class="dropdown-menu">
                @for (deporte of deportes; track deporte.id) {
                  <button
                    type="button"
                    class="dropdown-item"
                    [class.seleccionado]="canchaData.id_deporte === deporte.id"
                    (click)="seleccionarDeporte(deporte)">
                    <i class="fas fa-circle-dot"></i>
                    <span class="opcion-label">{{ deporte.nombre }}</span>
                    @if (canchaData.id_deporte === deporte.id) {
                      <i class="fas fa-check check-icon"></i>
                    }
                  </button>
                }
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Fila 2: Sede -->
      <div class="form-row">
        <div class="form-group full-width">
          <label for="sede">Sede</label>
          <div class="dropdown-sede" [class.activo]="dropdownSedeAbierto()">
            <button
              type="button"
              class="btn-dropdown-custom"
              (click)="toggleDropdownSede()"
              [class.activo]="dropdownSedeAbierto()">
              <span class="dropdown-current">
                <i class="fas fa-building"></i>
                {{ getNombreSede() }}
              </span>
              <i class="fas fa-chevron-down"></i>
            </button>

            @if (dropdownSedeAbierto()) {
              <div class="dropdown-menu">
                @if (sedes.length === 0) {
                  <div class="dropdown-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Cargando sedes...</span>
                  </div>
                } @else {
                  @for (sede of sedes; track sede.id_sede) {
                    <button
                      type="button"
                      class="dropdown-item"
                      [class.seleccionado]="canchaData.id_sede === sede.id_sede"
                      (click)="seleccionarSede(sede)">
                      <i class="fas fa-map-marker-alt"></i>
                      <span class="opcion-label">{{ sede.nombre_sede }}</span>
                      @if (canchaData.id_sede === sede.id_sede) {
                        <i class="fas fa-check check-icon"></i>
                      }
                    </button>
                  }
                }
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Fila 3: Largo y Ancho -->
      <div class="form-row">
        <div class="form-group">
          <label for="largo">Largo (m)</label>
          <input
            type="number"
            id="largo"
            name="largo"
            [(ngModel)]="canchaData.largo"
            min="1"
            max="200"
            required
          />
        </div>

        <div class="form-group">
          <label for="ancho">Ancho (m)</label>
          <input
            type="number"
            id="ancho"
            name="ancho"
            [(ngModel)]="canchaData.ancho"
            min="1"
            max="200"
            required
          />
        </div>
      </div>

      <!-- Fila 4: Tarifa, Tipo y Estado -->
      <div class="form-row three-cols">
        <div class="form-group">
          <label for="tarifa">Tarifa</label>
          <input
            type="number"
            id="tarifa"
            name="tarifa"
            [(ngModel)]="canchaData.tarifa"
            min="0"
            step="0.01"
            required
          />
        </div>

        <div class="form-group">
          <label for="tipo">Tipo</label>
          <div class="dropdown-superficie" [class.activo]="dropdownSuperficieAbierto()">
            <button
              type="button"
              class="btn-dropdown-custom"
              (click)="toggleDropdownSuperficie()"
              [class.activo]="dropdownSuperficieAbierto()">
              <span class="dropdown-current">
                <i class="fas fa-layer-group"></i>
                {{ canchaData.tipo_superficie || 'Tipo de superficie' }}
              </span>
              <i class="fas fa-chevron-down"></i>
            </button>

            @if (dropdownSuperficieAbierto()) {
              <div class="dropdown-menu">
                @for (tipo of tiposSuperficie; track tipo) {
                  <button
                    type="button"
                    class="dropdown-item"
                    [class.seleccionado]="canchaData.tipo_superficie === tipo"
                    (click)="seleccionarSuperficie(tipo)">
                    <i class="fas fa-circle-dot"></i>
                    <span class="opcion-label">{{ tipo }}</span>
                    @if (canchaData.tipo_superficie === tipo) {
                      <i class="fas fa-check check-icon"></i>
                    }
                  </button>
                }
              </div>
            }
          </div>
        </div>

        <div class="form-group">
          <label for="estado">Estado</label>
          <div class="dropdown-estado" [class.activo]="dropdownEstadoAbierto()">
            <button
              type="button"
              class="btn-dropdown-custom"
              (click)="toggleDropdownEstado()"
              [class.activo]="dropdownEstadoAbierto()">
              <span class="dropdown-current">
                <i class="fas fa-info-circle"></i>
                {{ canchaData.estado || 'Estado' }}
              </span>
              <i class="fas fa-chevron-down"></i>
            </button>

            @if (dropdownEstadoAbierto()) {
              <div class="dropdown-menu">
                @for (estado of estadosCancha; track estado) {
                  <button
                    type="button"
                    class="dropdown-item"
                    [class.seleccionado]="canchaData.estado === estado"
                    (click)="seleccionarEstado(estado)">
                    <i class="fas fa-circle-dot"></i>
                    <span class="opcion-label">{{ estado }}</span>
                    @if (canchaData.estado === estado) {
                      <i class="fas fa-check check-icon"></i>
                    }
                  </button>
                }
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Botones -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-cancelar"
          (click)="cancelar()"
          [disabled]="isLoading"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="btn btn-crear"
          [disabled]="isLoading || canchaForm.invalid"
        >
          <span class="spinner" *ngIf="isLoading"></span>
          <span *ngIf="!isLoading">{{ isEditMode ? 'Actualizar' : 'Crear' }}</span>
        </button>
      </div>
    </form>
  </div>
</div>
