<div class="anuncios-container">
  <!-- Formulario para crear anuncio -->
  <div class="anuncio-form-card">
    <div class="card-header">
      <h2>
        <span class="material-icons">campaign</span>
        Crear Nuevo Anuncio
      </h2>
    </div>

    <form [formGroup]="anuncioForm" (ngSubmit)="onSubmit()" class="anuncio-form">
      <!-- Título/Asunto -->
      <div class="form-group">
        <label for="titulo" class="form-label">
          <span class="material-icons">title</span>
          Título del Anuncio
        </label>
        <input
          type="text"
          class="form-input"
          id="titulo"
          formControlName="titulo"
          placeholder="Ej: ¡Nueva promoción disponible!"
          maxlength="100"
        />
        <div class="form-meta">
          <span class="char-counter">
            {{ anuncioForm.get('titulo')?.value?.length || 0 }} / 100
          </span>
          @if (anuncioForm.get('titulo')?.invalid && anuncioForm.get('titulo')?.touched) {
            <span class="error-message">
              <span class="material-icons">error</span>
              El título es obligatorio (mínimo 5 caracteres)
            </span>
          }
        </div>
      </div>

      <!-- Descripción/Mensaje -->
      <div class="form-group">
        <label for="descripcion" class="form-label">
          <span class="material-icons">description</span>
          Descripción del Anuncio
        </label>
        <textarea
          class="form-textarea"
          id="descripcion"
          formControlName="descripcion"
          rows="4"
          placeholder="Escribe el mensaje completo del anuncio..."
          maxlength="500"
        ></textarea>
        <div class="form-meta">
          <span class="char-counter">
            {{ anuncioForm.get('descripcion')?.value?.length || 0 }} / 500
          </span>
          @if (anuncioForm.get('descripcion')?.invalid && anuncioForm.get('descripcion')?.touched) {
            <span class="error-message">
              <span class="material-icons">error</span>
              La descripción es obligatoria (mínimo 10 caracteres)
            </span>
          }
        </div>
      </div>

      <!-- Tipo de Mensaje -->
      <div class="form-group">
        <label class="form-label">
          <span class="material-icons">category</span>
          Tipo de Mensaje
        </label>
        <div class="filtro-tipo-form" [class.activo]="dropdownTipoFormAbierto()">
          <button type="button" class="btn-dropdown-filtro" [class.activo]="dropdownTipoFormAbierto()" (click)="toggleDropdownTipoForm()">
            <span class="dropdown-current">
              <i [class]="getTipoIconClass(anuncioForm.get('tipo')?.value)"></i>
              <span>{{ getTipoLabelForm(anuncioForm.get('tipo')?.value) }}</span>
            </span>
            <i class="fas fa-chevron-down"></i>
          </button>
          @if (dropdownTipoFormAbierto()) {
            <div class="dropdown-menu-filtro">
              <button type="button" class="dropdown-item-filtro" [class.seleccionado]="anuncioForm.get('tipo')?.value === 'info'" (click)="seleccionarTipoForm('info')">
                <i class="fas fa-info-circle"></i>
                <span class="opcion-label">Información - Para noticias generales</span>
                @if (anuncioForm.get('tipo')?.value === 'info') {
                  <i class="fas fa-check check-icon"></i>
                }
              </button>
              <button type="button" class="dropdown-item-filtro" [class.seleccionado]="anuncioForm.get('tipo')?.value === 'success'" (click)="seleccionarTipoForm('success')">
                <i class="fas fa-check-circle"></i>
                <span class="opcion-label">Éxito - Para anunciar logros</span>
                @if (anuncioForm.get('tipo')?.value === 'success') {
                  <i class="fas fa-check check-icon"></i>
                }
              </button>
              <button type="button" class="dropdown-item-filtro" [class.seleccionado]="anuncioForm.get('tipo')?.value === 'warning'" (click)="seleccionarTipoForm('warning')">
                <i class="fas fa-exclamation-triangle"></i>
                <span class="opcion-label">Advertencia - Para avisos importantes</span>
                @if (anuncioForm.get('tipo')?.value === 'warning') {
                  <i class="fas fa-check check-icon"></i>
                }
              </button>
              <button type="button" class="dropdown-item-filtro" [class.seleccionado]="anuncioForm.get('tipo')?.value === 'error'" (click)="seleccionarTipoForm('error')">
                <i class="fas fa-times-circle"></i>
                <span class="opcion-label">Error/Urgente - Para problemas críticos</span>
                @if (anuncioForm.get('tipo')?.value === 'error') {
                  <i class="fas fa-check check-icon"></i>
                }
              </button>
              <button type="button" class="dropdown-item-filtro" [class.seleccionado]="anuncioForm.get('tipo')?.value === 'promotion'" (click)="seleccionarTipoForm('promotion')">
                <i class="fas fa-tag"></i>
                <span class="opcion-label">Promoción - Para ofertas y descuentos</span>
                @if (anuncioForm.get('tipo')?.value === 'promotion') {
                  <i class="fas fa-check check-icon"></i>
                }
              </button>
            </div>
          }
        </div>
        <div class="tipo-preview">
          <div class="preview-badge" [attr.data-tipo]="anuncioForm.get('tipo')?.value">
            <span class="material-icons">
              {{ getTipoIcon(anuncioForm.get('tipo')?.value) }}
            </span>
            {{ getTipoLabel(anuncioForm.get('tipo')?.value) }}
          </div>
        </div>
      </div>

      <!-- Botones -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="resetForm()"
        >
          <span class="material-icons">restart_alt</span>
          Limpiar
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!anuncioForm.valid || isSubmitting"
        >
          @if (isSubmitting) {
            <span class="spinner"></span>
            Guardando...
          } @else {
            <span class="material-icons">save</span>
            Guardar Anuncio
          }
        </button>
      </div>
    </form>
  </div>

  <!-- Filtros -->
  <div class="filtros-section">
    <div class="search-box">
      <span class="material-icons">search</span>
      <input
        type="text"
        placeholder="Buscar anuncios..."
        [(ngModel)]="filtroBusqueda"
        (input)="aplicarFiltros()"
      />
    </div>

    <div class="filtro-tipo" [class.activo]="dropdownTipoAbierto()">
      <button type="button" class="btn-dropdown-filtro" [class.activo]="dropdownTipoAbierto()" (click)="toggleDropdownTipo()">
        <span class="dropdown-current">
          <i class="fas fa-filter"></i>
          <span>{{ tipoSeleccionado() }}</span>
        </span>
        <i class="fas fa-chevron-down"></i>
      </button>
      @if (dropdownTipoAbierto()) {
        <div class="dropdown-menu-filtro">
          <button type="button" class="dropdown-item-filtro" [class.seleccionado]="filtroTipo === 'todos'" (click)="seleccionarTipo('todos')">
            <i class="fas fa-th"></i>
            <span class="opcion-label">Todos los tipos</span>
            @if (filtroTipo === 'todos') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
          <button type="button" class="dropdown-item-filtro" [class.seleccionado]="filtroTipo === 'info'" (click)="seleccionarTipo('info')">
            <i class="fas fa-info-circle"></i>
            <span class="opcion-label">Información</span>
            @if (filtroTipo === 'info') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
          <button type="button" class="dropdown-item-filtro" [class.seleccionado]="filtroTipo === 'success'" (click)="seleccionarTipo('success')">
            <i class="fas fa-check-circle"></i>
            <span class="opcion-label">Éxito</span>
            @if (filtroTipo === 'success') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
          <button type="button" class="dropdown-item-filtro" [class.seleccionado]="filtroTipo === 'warning'" (click)="seleccionarTipo('warning')">
            <i class="fas fa-exclamation-triangle"></i>
            <span class="opcion-label">Advertencia</span>
            @if (filtroTipo === 'warning') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
          <button type="button" class="dropdown-item-filtro" [class.seleccionado]="filtroTipo === 'error'" (click)="seleccionarTipo('error')">
            <i class="fas fa-times-circle"></i>
            <span class="opcion-label">Error/Urgente</span>
            @if (filtroTipo === 'error') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
          <button type="button" class="dropdown-item-filtro" [class.seleccionado]="filtroTipo === 'promotion'" (click)="seleccionarTipo('promotion')">
            <i class="fas fa-tag"></i>
            <span class="opcion-label">Promoción</span>
            @if (filtroTipo === 'promotion') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
        </div>
      }
    </div>

    <div class="filtro-estado" [class.activo]="dropdownEstadoAbierto()">
      <button type="button" class="btn-dropdown-filtro" [class.activo]="dropdownEstadoAbierto()" (click)="toggleDropdownEstado()">
        <span class="dropdown-current">
          <i class="fas fa-toggle-on"></i>
          <span>{{ estadoSeleccionado() }}</span>
        </span>
        <i class="fas fa-chevron-down"></i>
      </button>
      @if (dropdownEstadoAbierto()) {
        <div class="dropdown-menu-filtro">
          <button type="button" class="dropdown-item-filtro" [class.seleccionado]="filtroEstado === 'todos'" (click)="seleccionarEstado('todos')">
            <i class="fas fa-th"></i>
            <span class="opcion-label">Todos</span>
            @if (filtroEstado === 'todos') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
          <button type="button" class="dropdown-item-filtro" [class.seleccionado]="filtroEstado === 'activo'" (click)="seleccionarEstado('activo')">
            <i class="fas fa-check-circle"></i>
            <span class="opcion-label">Activos</span>
            @if (filtroEstado === 'activo') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
          <button type="button" class="dropdown-item-filtro" [class.seleccionado]="filtroEstado === 'inactivo'" (click)="seleccionarEstado('inactivo')">
            <i class="fas fa-times-circle"></i>
            <span class="opcion-label">Inactivos</span>
            @if (filtroEstado === 'inactivo') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
        </div>
      }
    </div>

    <div class="stat-badge">
      <span class="material-icons">campaign</span>
      {{ anunciosFiltrados().length }} Anuncio{{ anunciosFiltrados().length !== 1 ? 's' : '' }}
    </div>

    <button type="button" class="btn-limpiar" (click)="limpiarFiltros()">
      <i class="fas fa-redo"></i>
      Limpiar
    </button>
  </div>

  <!-- Lista de anuncios -->
  <div class="anuncios-list-card">
    <div class="card-header">
      <h2>
        <span class="material-icons">list</span>
        Anuncios Registrados
      </h2>
      <span class="count-badge">{{ anunciosFiltrados().length }}</span>
    </div>

    @if (isLoading) {
      <div class="loading-state">
        <span class="spinner"></span>
        <p>Cargando anuncios...</p>
      </div>
    } @else if (anunciosFiltrados().length > 0) {
      <div class="anuncios-list">
        @for (anuncio of anunciosFiltrados(); track anuncio.id_anuncio) {
          <div class="anuncio-item" [attr.data-tipo]="anuncio.tipo">
            <div class="anuncio-icon" [attr.data-tipo]="anuncio.tipo">
              <span class="material-icons">
                {{ getTipoIcon(anuncio.tipo) }}
              </span>
            </div>
            <div class="anuncio-info">
              <div class="anuncio-header-row">
                <h3 class="anuncio-titulo">{{ anuncio.titulo }}</h3>
                <span class="tipo-badge" [attr.data-tipo]="anuncio.tipo">
                  {{ getTipoLabel(anuncio.tipo) }}
                </span>
              </div>
              <p class="anuncio-descripcion">{{ anuncio.descripcion }}</p>
              <div class="anuncio-footer">
                <span class="fecha-creacion">
                  <span class="material-icons">schedule</span>
                  {{ anuncio.fecha_creacion ? formatDate(anuncio.fecha_creacion) : 'Hoy' }}
                </span>
                @if (!anuncio.activo) {
                  <span class="status-badge inactive">
                    <span class="material-icons">visibility_off</span>
                    Inactivo
                  </span>
                }
              </div>
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="empty-state">
        <div class="empty-icon">
          <span class="material-icons">notifications_none</span>
        </div>
        <h3>No hay anuncios registrados</h3>
        <p>Crea tu primer anuncio usando el formulario superior</p>
      </div>
    }
  </div>
</div>
