<div class="crear-torneo-container">
  <div class="header-section">
    <h1 class="page-title">
      <i class="fas fa-trophy"></i>
      {{ esEdicion ? 'Editar Torneo' : 'Crear Torneo' }}
    </h1>
    <button class="btn-volver" (click)="volver()">
      <i class="fas fa-arrow-left"></i>
      Volver
    </button>
  </div>

  <form [formGroup]="torneoForm" (ngSubmit)="onSubmit()" class="torneo-form">
    <div class="form-grid">
      <!-- Nombre -->
      <div class="form-group full-width">
        <label for="nombre" class="form-label">
          <i class="fas fa-tag"></i>
          Nombre del Torneo
        </label>
        <input
          type="text"
          id="nombre"
          formControlName="nombre"
          class="form-input"
          placeholder="Ej: Copa de Fútbol 2025"
          [class.invalid]="f['nombre'].invalid && f['nombre'].touched"
        />
        @if (f['nombre'].invalid && f['nombre'].touched) {
        <div class="error-message">
          @if (f['nombre'].errors?.['required']) {
          <span>El nombre es requerido</span>
          }
          @if (f['nombre'].errors?.['minlength']) {
          <span>Mínimo 3 caracteres</span>
          }
        </div>
        }
      </div>

      <!-- Descripción -->
      <div class="form-group full-width">
        <label for="descripcion" class="form-label">
          <i class="fas fa-align-left"></i>
          Descripción (opcional)
        </label>
        <textarea
          id="descripcion"
          formControlName="descripcion"
          class="form-textarea"
          rows="3"
          placeholder="Descripción del torneo..."
        ></textarea>
      </div>

      <!-- Deporte -->
      <div class="form-group dropdown-deporte" [class.activo]="dropdownDeporteAbierto()">
        <label for="id_deporte" class="form-label">
          <i class="fas fa-futbol"></i>
          Deporte
        </label>
        <button
          type="button"
          class="btn-dropdown-custom"
          (click)="toggleDropdownDeporte()"
          [class.invalid]="f['id_deporte'].invalid && f['id_deporte'].touched"
        >
          <span class="dropdown-text">{{ deporteSeleccionado() }}</span>
          <i class="fas fa-chevron-down dropdown-icon" [class.rotado]="dropdownDeporteAbierto()"></i>
        </button>
        @if (dropdownDeporteAbierto()) {
          <div class="dropdown-menu">
            @for (deporte of deportes; track deporte.id_deporte) {
              <div class="dropdown-item" (click)="seleccionarDeporte(deporte)">
                <i class="fas fa-futbol"></i>
                {{ deporte.nombre_deporte }}
              </div>
            }
          </div>
        }
        @if (f['id_deporte'].invalid && f['id_deporte'].touched) {
        <div class="error-message">
          El deporte es requerido
        </div>
        }
      </div>

      <!-- Tipo de Torneo -->
      <div class="form-group dropdown-tipo" [class.activo]="dropdownTipoAbierto()">
        <label for="tipo_torneo" class="form-label">
          <i class="fas fa-sitemap"></i>
          Tipo de Torneo
        </label>
        <button type="button" class="btn-dropdown-custom" (click)="toggleDropdownTipo()">
          <span class="dropdown-text">{{ tipoSeleccionado() }}</span>
          <i class="fas fa-chevron-down dropdown-icon" [class.rotado]="dropdownTipoAbierto()"></i>
        </button>
        @if (dropdownTipoAbierto()) {
          <div class="dropdown-menu">
            @for (tipo of tiposTorneo; track tipo.value) {
              <div class="dropdown-item" (click)="seleccionarTipo(tipo)">
                @if (tipo.value === 'grupo-eliminatoria') {
                  <i class="fas fa-layer-group"></i>
                } @else if (tipo.value === 'eliminatoria-directa') {
                  <i class="fas fa-sitemap"></i>
                } @else if (tipo.value === 'todos-contra-todos') {
                  <i class="fas fa-th"></i>
                } @else if (tipo.value === 'liga') {
                  <i class="fas fa-trophy"></i>
                }
                {{ tipo.label }}
              </div>
            }
          </div>
        }
      </div>

      <!-- Fecha Inicio -->
      <div class="form-group">
        <label for="fecha_inicio" class="form-label">
          <i class="fas fa-calendar-alt"></i>
          Fecha de Inicio
        </label>
        <input
          type="date"
          id="fecha_inicio"
          formControlName="fecha_inicio"
          class="form-input"
          [class.invalid]="f['fecha_inicio'].invalid && f['fecha_inicio'].touched"
        />
        @if (f['fecha_inicio'].invalid && f['fecha_inicio'].touched) {
        <div class="error-message">
          La fecha de inicio es requerida
        </div>
        }
      </div>

      <!-- Fecha Fin -->
      <div class="form-group">
        <label for="fecha_fin" class="form-label">
          <i class="fas fa-calendar-check"></i>
          Fecha de Fin
        </label>
        <input
          type="date"
          id="fecha_fin"
          formControlName="fecha_fin"
          class="form-input"
          [class.invalid]="f['fecha_fin'].invalid && f['fecha_fin'].touched"
        />
        @if (f['fecha_fin'].invalid && f['fecha_fin'].touched) {
        <div class="error-message">
          La fecha de fin es requerida
        </div>
        }
      </div>

      <!-- Fecha Cierre Inscripción -->
      <div class="form-group">
        <label for="fecha_cierre_inscripcion" class="form-label">
          <i class="fas fa-calendar-times"></i>
          Cierre de Inscripción
        </label>
        <input
          type="datetime-local"
          id="fecha_cierre_inscripcion"
          formControlName="fecha_cierre_inscripcion"
          class="form-input"
        />
        <small class="form-hint">Opcional: Fecha límite para inscripciones</small>
      </div>

      <!-- Máximo de Equipos -->
      <div class="form-group">
        <label for="max_equipos" class="form-label">
          <i class="fas fa-users"></i>
          Máximo de Equipos
        </label>
        <input
          type="number"
          id="max_equipos"
          formControlName="max_equipos"
          class="form-input"
          placeholder="Ej: 16"
          min="2"
          max="128"
        />
        <small class="form-hint">Dejar vacío para ilimitado</small>
        @if (f['max_equipos'].invalid && f['max_equipos'].touched) {
        <div class="error-message">
          @if (f['max_equipos'].errors?.['min']) {
          <span>Mínimo 2 equipos</span>
          }
          @if (f['max_equipos'].errors?.['max']) {
          <span>Máximo 128 equipos</span>
          }
        </div>
        }
      </div>

      <!-- Estado -->
      <div class="form-group dropdown-estado" [class.activo]="dropdownEstadoAbierto()">
        <label for="estado" class="form-label">
          <i class="fas fa-flag"></i>
          Estado
        </label>
        <button type="button" class="btn-dropdown-custom" (click)="toggleDropdownEstado()">
          <span class="dropdown-text">{{ estadoSeleccionado() }}</span>
          <i class="fas fa-chevron-down dropdown-icon" [class.rotado]="dropdownEstadoAbierto()"></i>
        </button>
        @if (dropdownEstadoAbierto()) {
          <div class="dropdown-menu">
            @for (estado of estadosPosibles; track estado.value) {
              <div class="dropdown-item" (click)="seleccionarEstado(estado)">
                @if (estado.value === 'abierto') {
                  <i class="fas fa-door-open"></i>
                } @else if (estado.value === 'en_curso') {
                  <i class="fas fa-play-circle"></i>
                } @else if (estado.value === 'cerrado') {
                  <i class="fas fa-lock"></i>
                } @else if (estado.value === 'finalizado') {
                  <i class="fas fa-flag-checkered"></i>
                }
                {{ estado.label }}
              </div>
            }
          </div>
        }
      </div>
    </div>

    <!-- Botones de Acción -->
    <div class="form-actions">
      <button type="button" class="btn-cancelar" (click)="volver()" [disabled]="cargando">
        <i class="fas fa-times"></i>
        Cancelar
      </button>
      <button type="submit" class="btn-guardar" [disabled]="cargando">
        <i class="fas" [ngClass]="cargando ? 'fa-spinner fa-spin' : 'fa-save'"></i>
        {{ cargando ? 'Guardando...' : (esEdicion ? 'Actualizar' : 'Crear') }}
      </button>
    </div>
  </form>
</div>
