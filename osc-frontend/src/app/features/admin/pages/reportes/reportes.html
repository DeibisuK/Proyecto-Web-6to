<div class="reports-page">
  <div class="reports-container">
    <!-- Filters Bar -->
    <div class="filters-bar">

      <div class="filter-group">
        <span class="material-icons filter-icon">filter_list</span>
        <label class="filter-label">Mes:</label>
        <select class="filter-select" [(ngModel)]="selectedMonth">
          <option [value]="-1">Todos</option>
          @for (month of months; track $index) {
            <option [value]="$index">{{ month }}</option>
          }
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Año:</label>
        <select class="filter-select" [(ngModel)]="selectedYear">
          @for (year of years; track year) {
            <option [value]="year">{{ year }}</option>
          }
        </select>
      </div>

      <div class="filter-summary">
        <span class="material-icons">calendar_today</span>
        <span class="summary-text">{{ selectedMonth === -1 ? 'Todos los meses' : months[selectedMonth] }} {{ selectedYear }}</span>
      </div>

      <button class="clear-filters-btn" (click)="clearFilters()">
        <span class="material-icons">refresh</span>
        Limpiar
      </button>
    </div>

    <!-- Main Content -->
    <div class="reports-content">

  <!-- Report Categories -->
  <div class="categories-grid">
    @for (category of reportCategories; track category.id) {
      <div class="category-card">
        <div
          class="category-header"
          (click)="toggleCategory(category.id)"
        >
          <div class="category-left">
            <div class="category-icon">
              <span class="material-icons">{{ category.iconName }}</span>
            </div>
            <span class="category-title">{{ category.title }}</span>
          </div>
          <span
            class="material-icons chevron"
            [ngClass]="{'open': isCategoryExpanded(category.id)}"
          >
            expand_more
          </span>
        </div>

        @if (isCategoryExpanded(category.id)) {
          <div class="dropdown-menu">
            @for (option of category.options; track option.id) {
              <div class="dropdown-item">
                <span class="item-name">{{ option.label }}</span>
                <div class="item-actions">
                  <button
                    class="btn-export pdf"
                    (click)="handleExport(category.id, option.id, 'pdf', option.label)"
                  >
                    <span class="material-icons">description</span>
                    PDF
                  </button>
                  <button
                    class="btn-export excel"
                    (click)="handleExport(category.id, option.id, 'excel', option.label)"
                  >
                    <span class="material-icons">table_chart</span>
                    Excel
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </div>
    }
  </div>

      <!-- Recent Reports -->
      <div class="recent-reports">
        <div class="section-header">
          <span class="material-icons">history</span>
          <h3 class="section-title">Reportes Recientes</h3>
        </div>
        @if (recentReports.length === 0) {
          <div class="no-reports">
            <span class="material-icons">folder_open</span>
            <p>No hay reportes recientes</p>
            <span class="hint">Los reportes descargados aparecerán aquí</span>
          </div>
        } @else {
          <div class="report-list">
            @for (report of recentReports; track report.name + report.date) {
              <div class="report-item">
                <div class="report-left">
                  <div class="report-icon" [ngClass]="report.type">
                    @if (report.type === 'pdf') {
                      <span class="material-icons">description</span>
                    } @else {
                      <span class="material-icons">table_chart</span>
                    }
                  </div>
                  <div class="report-info">
                    <h4>{{ report.name }}</h4>
                    <p class="report-meta">{{ getTimeSinceDownload(report.date) }}</p>
                  </div>
                </div>
                <span class="report-badge" [ngClass]="report.type">
                  {{ report.type === 'pdf' ? 'PDF' : 'EXCEL' }}
                </span>
              </div>
            }
          </div>
        }
      </div>
    </div>
  </div>
</div>
