<div class="sedes-container">
  <!-- Filtros -->
  <div class="filtros-section">
    <div class="search-box">
      <span class="material-icons">search</span>
      <input
        type="text"
        placeholder="Buscar sede por nombre, ciudad o dirección..."
        (input)="onSearchChange($event)">
    </div>

    <div class="filtro-estado" [class.activo]="dropdownEstadoAbierto()">
      <button
        type="button"
        class="btn-dropdown-filtro"
        (click)="toggleDropdownEstado()"
        [class.activo]="dropdownEstadoAbierto()">
        <span class="dropdown-current">
          <i class="fas fa-filter"></i>
          {{ estadoSeleccionado() }}
        </span>
        <i class="fas fa-chevron-down"></i>
      </button>

      @if (dropdownEstadoAbierto()) {
        <div class="dropdown-menu-filtro">
          <button
            type="button"
            class="dropdown-item-filtro"
            [class.seleccionado]="estadoFiltro === ''"
            (click)="seleccionarEstado(null)">
            <i class="fas fa-th"></i>
            <span class="opcion-label">Todos los estados</span>
            @if (estadoFiltro === '') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
          <button
            type="button"
            class="dropdown-item-filtro"
            [class.seleccionado]="estadoFiltro === 'Activo'"
            (click)="seleccionarEstado('Activo')">
            <i class="fas fa-check-circle"></i>
            <span class="opcion-label">Activo</span>
            @if (estadoFiltro === 'Activo') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
          <button
            type="button"
            class="dropdown-item-filtro"
            [class.seleccionado]="estadoFiltro === 'Mantenimiento'"
            (click)="seleccionarEstado('Mantenimiento')">
            <i class="fas fa-tools"></i>
            <span class="opcion-label">Mantenimiento</span>
            @if (estadoFiltro === 'Mantenimiento') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
          <button
            type="button"
            class="dropdown-item-filtro"
            [class.seleccionado]="estadoFiltro === 'Inactivo'"
            (click)="seleccionarEstado('Inactivo')">
            <i class="fas fa-times-circle"></i>
            <span class="opcion-label">Inactivo</span>
            @if (estadoFiltro === 'Inactivo') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
        </div>
      }
    </div>

    <div class="stat-badge">
      <span class="material-icons">location_on</span>
      <span>{{ sedesFiltradas.length }} sedes</span>
    </div>

    <a routerLink="/admin/crear-sede" class="btn-crear">
      <span class="material-icons">add</span>
      Nueva Sede
    </a>
  </div>

  <!-- Grid de Sedes -->
  <div class="sedes-grid">
    <div class="sede-card" *ngFor="let sede of sedesFiltradas">
      <!-- Mapa -->
      <div class="sede-map">
        <app-mini-map
          *ngIf="sede.latitud && sede.longitud"
          [latitud]="sede.latitud"
          [longitud]="sede.longitud"
          [zoom]="14">
        </app-mini-map>
        <div *ngIf="!sede.latitud || !sede.longitud" class="no-map-placeholder">
          <span class="material-icons">location_off</span>
          <p>Mapa no disponible</p>
        </div>
        <div class="map-overlay">
          <span class="material-icons">location_on</span>
        </div>
      </div>

      <!-- Contenido -->
      <div class="sede-content">
        <!-- Header con título y ciudad -->
        <div class="sede-header">
          <h3 class="sede-nombre">{{ sede.nombre_sede }}</h3>
          <span class="ciudad-badge">{{ sede.ciudad }}</span>
        </div>

        <!-- Dirección -->
        <div class="sede-direccion">
          <span class="material-icons">place</span>
          <span>{{ sede.direccion }}</span>
        </div>

        <!-- Información de contacto -->
        <div class="sede-info">
          <div class="info-item" *ngIf="sede.telefono">
            <span class="material-icons">phone</span>
            <span>{{ sede.telefono }}</span>
          </div>
          <div class="info-item" *ngIf="sede.email">
            <span class="material-icons">email</span>
            <span>{{ sede.email }}</span>
          </div>
        </div>

        <!-- Estado y Acciones -->
        <div class="sede-footer">
          <span
            class="estado-badge"
            [class.estado-activo]="sede.estado === 'Activo'"
            [class.estado-mantenimiento]="sede.estado === 'Mantenimiento'"
            [class.estado-inactivo]="sede.estado === 'Inactivo'">
            {{ sede.estado }}
          </span>

          <div class="sede-actions" *ngIf="sede.id_sede">
            <button
              class="action-btn btn-editar"
              [routerLink]="['/admin/editar-sede', sede.id_sede]"
              title="Editar sede">
              <span class="material-icons">edit</span>
            </button>
            <button
              class="action-btn btn-eliminar"
              (click)="eliminarSede(sede.id_sede)"
              title="Eliminar sede">
              <span class="material-icons">delete</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado vacío -->
  <div class="empty-state" *ngIf="sedesFiltradas.length === 0">
    <div class="empty-icon">
      <span class="material-icons">location_off</span>
    </div>
    <h3 class="empty-title">No se encontraron sedes</h3>
    <p class="empty-message">
      {{ searchTerm || estadoFiltro ? 'Intenta ajustar los filtros de búsqueda' : 'Comienza agregando una nueva sede' }}
    </p>
  </div>
</div>
