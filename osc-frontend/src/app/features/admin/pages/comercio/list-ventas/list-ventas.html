<div class="ventas-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>Gesti贸n de Ventas</h1>
      <p class="subtitle">Panel de administraci贸n de ventas completadas</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="exportData()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
        </svg>
        Exportar
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-header">
        <span class="stat-icon primary">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
          </svg>
        </span>
        <div class="stat-info">
          <p class="stat-label">Total Ventas</p>
          <h3 class="stat-value">{{ totalVentas }}</h3>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <span class="stat-icon success">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
        </span>
        <div class="stat-info">
          <p class="stat-label">Ventas Hoy</p>
          <h3 class="stat-value">${{ ventasHoy | number:'1.2-2' }}</h3>
        </div>
      </div>
    </div>

    <div class="stat-card highlight">
      <div class="stat-header">
        <span class="stat-icon warning">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="1" x2="12" y2="23"/>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
          </svg>
        </span>
        <div class="stat-info">
          <p class="stat-label">Ventas del Mes</p>
          <h3 class="stat-value">${{ ventasMes | number:'1.2-2' }}</h3>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <span class="stat-icon info">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
          </svg>
        </span>
        <div class="stat-info">
          <p class="stat-label">Completadas</p>
          <h3 class="stat-value">{{ ventasCompletadas }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="controls-bar">
    <div class="search-box">
      <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/>
        <path d="M21 21l-4.35-4.35"/>
      </svg>
      <input
        type="text"
        class="search-input"
        placeholder="Buscar por ID, cliente, UUID factura..."
        [(ngModel)]="searchQuery"
        (input)="onSearch()"
      />
    </div>

    <div class="filter-group">
      <select class="filter-select" [(ngModel)]="dateFilter" (change)="applyFilters()">
        <option value="today">Hoy</option>
        <option value="week">Esta semana</option>
        <option value="month">Este mes</option>
        <option value="custom">Personalizado</option>
      </select>
    </div>
  </div>

  <!-- Data Table -->
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID Venta</th>
          <th>UUID Factura</th>
          <th>Cliente</th>
          <th>Items</th>
          <th>Fecha Venta</th>
          <th>Total</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let venta of paginatedVentas" class="table-row">
          <td>
            <span class="order-id">#{{ venta.id_pedido }}</span>
          </td>
          <td>
            <span class="uuid-text">{{ venta.uuid_factura }}</span>
          </td>
          <td>
            <div class="customer-cell">
              <div class="customer-avatar">{{ getCustomerInitials(venta.nombre_usuario) }}</div>
              <div class="customer-info">
                <span class="customer-name">{{ venta.nombre_usuario || 'Usuario' }}</span>
                <span class="customer-email">{{ venta.email_usuario || 'N/A' }}</span>
              </div>
            </div>
          </td>
          <td>
            <span class="type-badge product">
              {{ venta.total_items }} producto(s)
            </span>
          </td>
          <td>
            <div class="date-cell">
              <span class="date">{{ venta.fecha_pedido | date:'dd MMM yyyy' }}</span>
              <span class="time">{{ venta.fecha_pedido | date:'HH:mm' }}</span>
            </div>
          </td>
          <td>
            <span class="amount">${{ venta.total | number:'1.2-2' }}</span>
          </td>
          <td>
            <div class="actions-cell">
              <button class="action-btn view" title="Ver detalle" (click)="viewDetail(venta)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                </svg>
              </button>
              <button class="action-btn print" title="Imprimir factura" (click)="printInvoice(venta)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M6 9V2h12v7M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                  <rect x="6" y="14" width="12" height="8"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination">
    <div class="pagination-info">
      Mostrando {{ startIndex }} - {{ endIndex }} de {{ filteredVentas.length }} ventas
    </div>
    <div class="pagination-controls">
      <button class="page-btn" [disabled]="currentPage === 1" (click)="prevPage()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>

      <button
        *ngFor="let page of [1, 2, 3, 4, 5]"
        class="page-btn"
        [class.active]="page === currentPage"
        [disabled]="page > totalPages"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>

      <button class="page-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Detail Modal -->
<div class="modal-overlay" *ngIf="showDetailModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Detalle de Venta #{{ selectedVenta?.id_pedido }}</h2>
      <button class="close-btn" (click)="closeModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="modal-body" *ngIf="selectedVenta">
      <div class="order-info-grid">
        <div class="info-section">
          <h3>Informaci贸n del Cliente</h3>
          <p><strong>Nombre:</strong> {{ selectedVenta.nombre_usuario }}</p>
          <p><strong>Email:</strong> {{ selectedVenta.email_usuario }}</p>
          <p><strong>UUID Factura:</strong> {{ selectedVenta.uuid_factura }}</p>
        </div>

        <div class="info-section">
          <h3>Informaci贸n de la Venta</h3>
          <p><strong>Fecha:</strong> {{ selectedVenta.fecha_pedido | date:'dd MMM yyyy, HH:mm' }}</p>
          <p><strong>Estado:</strong>
            <span class="status-badge delivered">Entregado</span>
          </p>
          <p><strong>Total:</strong> ${{ selectedVenta.total | number:'1.2-2' }}</p>
        </div>
      </div>

      <div class="items-section">
        <h3>Productos Vendidos</h3>
        <table class="items-table">
          <thead>
            <tr>
              <th>Producto</th>
              <th>SKU</th>
              <th>Cantidad</th>
              <th>Precio Unit.</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of selectedVenta.items">
              <td>
                <div class="item-cell">
                  <img *ngIf="item.imagen_producto" [src]="item.imagen_producto" alt="{{ item.nombre_producto }}" class="item-image">
                  <span>{{ item.nombre_producto }}</span>
                </div>
              </td>
              <td>{{ item.sku }}</td>
              <td>{{ item.cantidad }}</td>
              <td>${{ item.precio_unitario | number:'1.2-2' }}</td>
              <td>${{ item.subtotal | number:'1.2-2' }}</td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="4" class="text-right"><strong>Total:</strong></td>
              <td><strong>${{ selectedVenta.total | number:'1.2-2' }}</strong></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
</div>
