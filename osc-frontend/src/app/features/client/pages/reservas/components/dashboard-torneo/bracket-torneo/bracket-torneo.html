<div class="bracket-page">
  <!-- Header -->
  <div class="page-header">
    <button class="btn-back" (click)="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Volver a Torneos
    </button>

    <div class="header-content" *ngIf="torneo">
      <div class="torneo-info">
        <h1>{{ torneo.nombre }}</h1>
        <p class="torneo-deporte">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <circle cx="12" cy="12" r="10"></circle>
          </svg>
          {{ torneo.nombre_deporte }}
        </p>
      </div>
      <span class="badge" [class]="'badge-' + torneo.estado">
        {{ torneo.estado === 'abierto' ? 'Inscripción Abierta' :
           torneo.estado === 'en_curso' ? 'En Curso' :
           torneo.estado === 'finalizado' ? 'Finalizado' : 'Cerrado' }}
      </span>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Cargando bracket del torneo...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error && !isLoading">
    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    <h3>{{ error }}</h3>
    <button class="btn-primary" (click)="goBack()">Volver a Torneos</button>
  </div>

  <!-- Bracket Container -->
  <div class="bracket-wrapper" *ngIf="!isLoading && !error && bracket.length > 0">
    <div class="bracket-container">
      <div class="bracket-scroll">
        <div class="bracket-ronda" *ngFor="let ronda of bracket">
          <div class="ronda-header">
            <h3>{{ ronda.nombre }}</h3>
          </div>
          <div class="partidos-lista">
            <div class="partido-wrapper" *ngFor="let partido of ronda.partidos">
              <div class="partido-card">
                <!-- Equipo 1 -->
                <div class="equipo" [class.ganador]="partido.ganador === 1">
                  <div class="equipo-info clickeable" *ngIf="partido.equipo1"
                       (click)="verEstadisticasEquipo(partido.equipo1, $event)">
                    <img *ngIf="partido.equipo1.logo" [src]="partido.equipo1.logo"
                         [alt]="partido.equipo1.nombre" class="equipo-logo">
                    <div *ngIf="!partido.equipo1.logo" class="equipo-logo-placeholder">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                      </svg>
                    </div>
                    <span class="equipo-nombre">{{ partido.equipo1.nombre }}</span>
                    <svg class="icono-stats" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 20V10M12 20V4M6 20v-6"></path>
                    </svg>
                  </div>
                  <span *ngIf="!partido.equipo1" class="equipo-placeholder">Por definir</span>
                </div>

                <div class="vs-divider">
                  <span>VS</span>
                </div>

                <!-- Equipo 2 -->
                <div class="equipo" [class.ganador]="partido.ganador === 2">
                  <div class="equipo-info clickeable" *ngIf="partido.equipo2"
                       (click)="verEstadisticasEquipo(partido.equipo2, $event)">
                    <img *ngIf="partido.equipo2.logo" [src]="partido.equipo2.logo"
                         [alt]="partido.equipo2.nombre" class="equipo-logo">
                    <div *ngIf="!partido.equipo2.logo" class="equipo-logo-placeholder">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                      </svg>
                    </div>
                    <span class="equipo-nombre">{{ partido.equipo2.nombre }}</span>
                    <svg class="icono-stats" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 20V10M12 20V4M6 20v-6"></path>
                    </svg>
                  </div>
                  <span *ngIf="!partido.equipo2" class="equipo-placeholder">Por definir</span>
                </div>

                <!-- Acciones del partido -->
                <div class="partido-actions" *ngIf="esPartidoReal(partido) && partido.id_partido">
                  <button class="btn-ver-partido" (click)="verDetallePartido(partido)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    Ver detalles
                  </button>
                </div>
                <div class="partido-placeholder" *ngIf="!esPartidoReal(partido) || !partido.id_partido">
                  <span>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="12" y1="8" x2="12" y2="12"></line>
                      <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    Pendiente de programación
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel Lateral de Estadísticas -->
    <div class="panel-estadisticas" *ngIf="mostrarEstadisticas && equipoSeleccionado">
      <div class="panel-header">
        <div class="equipo-header-info">
          <img *ngIf="equipoSeleccionado.logo" [src]="equipoSeleccionado.logo"
               [alt]="equipoSeleccionado.nombre" class="equipo-logo-grande">
          <div *ngIf="!equipoSeleccionado.logo" class="equipo-logo-placeholder-grande">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
            </svg>
          </div>
          <div class="equipo-info-text">
            <h3>{{ equipoSeleccionado.nombre }}</h3>
          </div>
        </div>
        <button class="btn-cerrar-panel" (click)="cerrarEstadisticas()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="panel-body" *ngIf="estadisticasEquipo; else loadingStats">
        <!-- Resumen Principal -->
        <div class="resumen-principal">
          <div class="resumen-card grande">
            <div class="resumen-icono puntos">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
              </svg>
            </div>
            <div class="resumen-texto">
              <span class="resumen-numero">{{ estadisticasEquipo.puntos }}</span>
              <span class="resumen-etiqueta">Puntos</span>
            </div>
          </div>

          <div class="resumen-card">
            <div class="resumen-icono partidos">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="10"></circle>
              </svg>
            </div>
            <div class="resumen-texto">
              <span class="resumen-numero">{{ estadisticasEquipo.partidos_jugados }}</span>
              <span class="resumen-etiqueta">Partidos</span>
            </div>
          </div>
        </div>

        <!-- Destacados (MVP y Goleador) -->
        <div class="seccion-destacados" *ngIf="estadisticasEquipo.mvp || estadisticasEquipo.max_goleador">
          <h4 class="seccion-titulo">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
            </svg>
            Destacados
          </h4>
          <div class="destacados-grid">
            <div class="destacado-card mvp" *ngIf="estadisticasEquipo.mvp">
              <div class="destacado-icono">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                </svg>
              </div>
              <div class="destacado-info">
                <span class="destacado-label">MVP del Equipo</span>
                <span class="destacado-nombre">{{ estadisticasEquipo.mvp }}</span>
              </div>
            </div>

            <div class="destacado-card goleador" *ngIf="estadisticasEquipo.max_goleador">
              <div class="destacado-icono">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <circle cx="12" cy="12" r="6"></circle>
                  <circle cx="12" cy="12" r="2"></circle>
                </svg>
              </div>
              <div class="destacado-info">
                <span class="destacado-label">Máximo Goleador</span>
                <span class="destacado-nombre">{{ estadisticasEquipo.max_goleador }} ({{ estadisticasEquipo.goles_max || 0 }} goles)</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Registro -->
        <div class="seccion-estadisticas">
          <h4 class="seccion-titulo">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 20V10M12 20V4M6 20v-6"></path>
            </svg>
            Registro
          </h4>
          <div class="registro-grid">
            <div class="registro-item victorias">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 11l3 3L22 4"></path>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
              </svg>
              <div class="registro-info">
                <span class="registro-valor">{{ estadisticasEquipo.victorias }}</span>
                <span class="registro-label">Victorias</span>
              </div>
            </div>

            <div class="registro-item empates">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              <div class="registro-info">
                <span class="registro-valor">{{ estadisticasEquipo.empates }}</span>
                <span class="registro-label">Empates</span>
              </div>
            </div>

            <div class="registro-item derrotas">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
              <div class="registro-info">
                <span class="registro-valor">{{ estadisticasEquipo.derrotas }}</span>
                <span class="registro-label">Derrotas</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Goles -->
        <div class="seccion-estadisticas">
          <h4 class="seccion-titulo">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <circle cx="12" cy="12" r="6"></circle>
              <circle cx="12" cy="12" r="2"></circle>
            </svg>
            Goles
          </h4>
          <div class="goles-comparacion">
            <div class="goles-item favor">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="10"></circle>
              </svg>
              <div class="goles-info">
                <span class="goles-numero">{{ estadisticasEquipo.goles_favor }}</span>
                <span class="goles-label">A Favor</span>
              </div>
            </div>

            <div class="goles-separador">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </div>

            <div class="goles-item contra">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="10" opacity="0.5"></circle>
              </svg>
              <div class="goles-info">
                <span class="goles-numero">{{ estadisticasEquipo.goles_contra }}</span>
                <span class="goles-label">En Contra</span>
              </div>
            </div>
          </div>

          <div class="diferencia-goles" [class.positivo]="estadisticasEquipo.diferencia_goles > 0"
               [class.negativo]="estadisticasEquipo.diferencia_goles < 0"
               [class.neutral]="estadisticasEquipo.diferencia_goles === 0">
            <span class="diferencia-label">Diferencia:</span>
            <span class="diferencia-valor">
              {{ estadisticasEquipo.diferencia_goles > 0 ? '+' : '' }}{{ estadisticasEquipo.diferencia_goles }}
            </span>
          </div>
        </div>

        <!-- Grupo (si existe) -->
        <div class="seccion-estadisticas" *ngIf="estadisticasEquipo.nombre_grupo">
          <div class="grupo-badge">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"></path>
            </svg>
            <span>Grupo <strong>{{ estadisticasEquipo.nombre_grupo }}</strong></span>
          </div>
        </div>
      </div>

      <ng-template #loadingStats>
        <div class="loading-stats">
          <div class="spinner-small"></div>
          <p>Cargando estadísticas...</p>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && !error && bracket.length === 0">
    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M3 3v18"></path>
      <path d="M3 12h9"></path>
      <path d="M12 3v18"></path>
      <path d="M12 6h9"></path>
      <path d="M12 18h9"></path>
    </svg>
    <h3>No hay equipos inscritos</h3>
    <p>Este torneo aún no tiene equipos registrados para generar el bracket.</p>
  </div>
</div>
