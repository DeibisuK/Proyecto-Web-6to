<div class="canchas-container">
  <!-- Header -->
  <div class="canchas-header-section">
    <h1>Reserva tu Cancha</h1>
    <p>Selecciona la cancha perfecta para tu deporte y horario</p>
  </div>

  <!-- Filtros -->
  <div class="filtros-section">
    <div class="search-box">
      <span class="material-icons">search</span>
      <input
        type="text"
        placeholder="Buscar canchas..."
        [ngModel]="searchTerm()"
        (ngModelChange)="searchTerm.set($event)"
      />
    </div>

    <div class="filtro-deporte" [class.activo]="dropdownDeporteAbierto()">
      <button type="button" class="btn-dropdown-filtro" [class.activo]="dropdownDeporteAbierto()" (click)="toggleDropdownDeporte()">
        <span class="dropdown-current">
          <i class="fas fa-futbol"></i>
          <span>{{ deporteSeleccionado() }}</span>
        </span>
        <i class="fas fa-chevron-down"></i>
      </button>
      @if (dropdownDeporteAbierto()) {
        <div class="dropdown-menu-filtro">
          <button type="button" class="dropdown-item-filtro" [class.seleccionado]="selectedDeporte() === ''" (click)="seleccionarDeporte('')">
            <i class="fas fa-th"></i>
            <span class="opcion-label">Todos los deportes</span>
            @if (selectedDeporte() === '') {
              <i class="fas fa-check check-icon"></i>
            }
          </button>
          @for (deporte of deportes; track deporte.id_deporte) {
            <button type="button" class="dropdown-item-filtro" [class.seleccionado]="selectedDeporte() === deporte.id_deporte.toString()" (click)="seleccionarDeporte(deporte.id_deporte.toString())">
              <i class="fas fa-futbol"></i>
              <span class="opcion-label">{{ deporte.nombre_deporte }}</span>
              @if (selectedDeporte() === deporte.id_deporte.toString()) {
                <i class="fas fa-check check-icon"></i>
              }
            </button>
          }
        </div>
      }
    </div>

    <div class="filtro-fecha">
      <button type="button" class="btn-dropdown-filtro" [class.activo]="dropdownFechaAbierto()" (click)="toggleDropdownFecha()">
        <span class="dropdown-current">
          <i class="fas fa-calendar"></i>
          <span>{{ fechaSeleccionada() }}</span>
        </span>
        <i class="fas fa-chevron-down"></i>
      </button>
      @if (dropdownFechaAbierto()) {
        <div class="dropdown-menu-filtro date-picker-dropdown">
          <input type="date" [min]="minDate" [ngModel]="selectedFecha()" (ngModelChange)="selectedFecha.set($event)" (change)="seleccionarFecha()" class="date-input-custom" />
        </div>
      }
    </div>

    <div class="stat-badge">
      <span class="material-icons">sports</span>
      {{ canchasFiltradas().length }} Cancha{{ canchasFiltradas().length !== 1 ? 's' : '' }}
    </div>

    <button type="button" class="btn-limpiar" (click)="limpiarFiltros()">
      <i class="fas fa-redo"></i>
      Limpiar
    </button>
  </div>

  <!-- Loading y Mensajes -->
  @if (isLoading()) {
    <div class="loading-state">
      <span class="spinner"></span>
      <p>Cargando canchas disponibles...</p>
    </div>
  }

  @if (errorMessage) {
    <div class="error-message-card">
      <span class="material-icons">error_outline</span>
      <p>{{ errorMessage }}</p>
    </div>
  }

  <!-- Grid de Canchas -->
  <div class="canchas-grid">
    @for (cancha of canchasFiltradas(); track cancha.id_cancha) {
    <div class="cancha-card">
      <!-- Imagen -->
      <div class="cancha-imagen">
        @if (cancha.imagen_url) {
          <img [src]="cancha.imagen_url" [alt]="cancha.nombre_cancha" />
        } @else {
          <div class="imagen-placeholder">
            <span class="material-icons">sports_soccer</span>
          </div>
        }
        <div class="cancha-estado-badge" [attr.data-estado]="cancha.estado">
          <span class="material-icons">
            {{ cancha.estado === 'Disponible' ? 'check_circle' : cancha.estado === 'Reservado' ? 'schedule' : 'block' }}
          </span>
          {{ cancha.estado }}
        </div>
      </div>

      <!-- Contenido -->
      <div class="cancha-content">
        <div class="cancha-header">
          <h3>{{ cancha.nombre_cancha }}</h3>
          <div class="cancha-rating">
            <i class="fas fa-star"></i>
            <span>4.5</span>
            <span class="reviews-count">(24)</span>
          </div>
        </div>

        <div class="cancha-details">
          <div class="detail-row">
            <span class="material-icons">attach_money</span>
            <span class="detail-label">Tarifa/Hora:</span>
            <span class="detail-value">${{ cancha.tarifa | number : '1.2-2' }}</span>
          </div>
          <div class="detail-row">
            <span class="material-icons">straighten</span>
            <span class="detail-label">Dimensiones:</span>
            <span class="detail-value">{{ cancha.largo }}m x {{ cancha.ancho }}m</span>
          </div>
          <div class="detail-row">
            <span class="material-icons">grass</span>
            <span class="detail-label">Superficie:</span>
            <span class="detail-value">{{ cancha.tipo_superficie }}</span>
          </div>
        </div>

        <button
          class="btn-reservar"
          [disabled]="cancha.estado !== 'Disponible'"
          [routerLink]="['/tienda/reservar-cancha', cancha.id_cancha]">
          <span class="material-icons">event_available</span>
          {{ cancha.estado === 'Disponible' ? 'Reservar Ahora' : cancha.estado }}
        </button>
      </div>
    </div>
    }

    @if (canchasFiltradas().length === 0 && !isLoading()) {
      <div class="empty-state">
        <span class="material-icons">sports</span>
        <h3>No se encontraron canchas</h3>
        <p>Intenta ajustar los filtros de b√∫squeda</p>
      </div>
    }
  </div>

</div>
